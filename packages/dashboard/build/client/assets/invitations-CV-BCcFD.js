import{a,j as e}from"./index-BBJX7inb.js";import{u as L}from"./useApi-Dn3zf_yp.js";import{B as v}from"./Badge-Bgbs80Ll.js";import{B as i}from"./Button-B1BdtBaM.js";import{C as M,b as O,a as U}from"./Card-CFtCxk2z.js";import{L as w,I as _}from"./Label-JIDdilb1.js";import{M as S}from"./Modal-CHOY4886.js";import{u as z}from"./ToastProvider-C_5kRdyY.js";import{u as D,T as F}from"./orgContext-C7qTc9MO.js";import{P}from"./plus-BqUPOgIb.js";import{C as A}from"./copy-DvjwGVz6.js";import"./chunk-WWGJGFF6-BoMxq1lg.js";import"./session-BZ9GPMw7.js";import"./createLucideIcon-BrAVhkf1.js";function ae(){const n=z(),{request:r,signedIn:o}=L(),{orgId:l,role:I}=D(),[c,f]=a.useState(null),[R,y]=a.useState(!1),[$,d]=a.useState(!1),[m,h]=a.useState(null),[b,T]=a.useState("member"),[x,N]=a.useState(""),p=I==="admin",g=a.useMemo(()=>(c==null?void 0:c.invitations)??[],[c]),u=a.useCallback(async()=>{if(o){y(!0);try{const t=await r({path:`/api/v1/organizations/${l}/invitations`});f(t)}catch(t){if(t&&typeof t=="object"&&"status"in t&&t.status===401)return;const s=t&&typeof t=="object"&&"message"in t?String(t.message):"";n.push({kind:"error",title:"Failed to load invitations",detail:s}),f(null)}finally{y(!1)}}},[o,l,r,n]);async function k(){if(!o)return;const t=x.trim().length===0?void 0:Number.isFinite(Number(x))?Number(x):NaN;if(t===0||Number.isNaN(t)){n.push({kind:"error",title:"max_uses must be a number ≥ 1"});return}try{const s=await r({path:`/api/v1/organizations/${l}/invitations`,method:"POST",body:{role:b,...t?{max_uses:t}:{}}});h(s),d(!1),N(""),await u()}catch(s){if(s&&typeof s=="object"&&"status"in s&&s.status===401)return;const j=s&&typeof s=="object"&&"message"in s?String(s.message):"";n.push({kind:"error",title:"Create failed",detail:j})}}async function B(t){if(o&&confirm(`Revoke invitation ${t}?`))try{await r({path:`/api/v1/organizations/${l}/invitations/${t}`,method:"DELETE"}),await u()}catch(s){if(s&&typeof s=="object"&&"status"in s&&s.status===401)return;const j=s&&typeof s=="object"&&"message"in s?String(s.message):"";n.push({kind:"error",title:"Revoke failed",detail:j})}}async function E(t){try{await navigator.clipboard.writeText(t),n.push({kind:"success",title:"Copied"})}catch{n.push({kind:"error",title:"Copy failed"})}}function C(t){return`${window.location.origin}/invite/${t}`}return a.useEffect(()=>{u()},[u]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx(O,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-content-primary",children:"Invitations"}),e.jsx("div",{className:"mt-1 text-sm text-content-tertiary",children:"Admins can generate shareable links for members to join."})]}),e.jsxs(i,{onClick:()=>d(!0),disabled:!p,children:[e.jsx(P,{className:"h-4 w-4"}),"New invite"]})]})}),e.jsxs(U,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"text-xs text-content-muted",children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"py-2 pr-3",children:"ID"}),e.jsx("th",{className:"py-2 pr-3",children:"Role"}),e.jsx("th",{className:"py-2 pr-3",children:"Uses"}),e.jsx("th",{className:"py-2 pr-3",children:"Status"}),e.jsx("th",{className:"py-2 pr-3"})]})}),e.jsxs("tbody",{children:[g.map(t=>e.jsxs("tr",{className:"border-b border-border-subtle",children:[e.jsx("td",{className:"py-3 pr-3 font-medium text-content-primary",children:t.id}),e.jsx("td",{className:"py-3 pr-3",children:e.jsx(v,{tone:t.role==="admin"?"neon":"muted",children:t.role})}),e.jsxs("td",{className:"py-3 pr-3 text-content-secondary",children:[t.use_count,e.jsx("span",{className:"text-content-muted",children:t.max_uses?` / ${t.max_uses}`:" / ∞"})]}),e.jsx("td",{className:"py-3 pr-3",children:t.revoked?e.jsx(v,{tone:"warn",children:"revoked"}):e.jsx(v,{children:"active"})}),e.jsx("td",{className:"py-3 pr-3",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsxs(i,{variant:"danger",size:"sm",disabled:!p||t.revoked,onClick:()=>B(t.id),children:[e.jsx(F,{className:"h-4 w-4"}),"Revoke"]})})})]},t.id)),g.length===0&&!R?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-6 text-center text-sm text-content-muted",children:"No invitations yet."})}):null]})]})}),e.jsx("div",{className:"mt-3 text-xs text-content-muted",children:"Note: Invitation tokens are only shown at creation time."})]})]}),e.jsx(S,{open:$,title:"Create invitation",onClose:()=>d(!1),onSubmit:k,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"role",children:"Role"}),e.jsxs("select",{id:"role",className:"h-10 w-full rounded-xl border border-border bg-surface-subtle px-3 text-sm text-content-primary",value:b,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"member",children:"member"}),e.jsx("option",{value:"admin",children:"admin"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"maxUses",children:"Max uses (optional)"}),e.jsx(_,{id:"maxUses",value:x,onChange:t=>N(t.target.value),placeholder:"e.g. 5"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(i,{onClick:k,disabled:!p,children:"Create"})]})]})}),e.jsx(S,{open:!!m,title:"Invitation token (shareable link)",onClose:()=>h(null),children:m?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-content-tertiary",children:"Share this link to invite someone. The token is embedded."}),e.jsxs("div",{className:"rounded-2xl border border-border bg-surface-subtle p-4",children:[e.jsx("div",{className:"text-xs text-content-muted",children:"Invite link"}),e.jsx("div",{className:"mt-1 break-all font-mono text-xs text-content-primary",children:C(m.token)})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(i,{variant:"secondary",onClick:()=>E(C(m.token)),children:[e.jsx(A,{className:"h-4 w-4"}),"Copy"]}),e.jsx(i,{onClick:()=>h(null),children:"Done"})]})]}):null})]})}export{ae as default};
