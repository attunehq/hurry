import{a as n,j as t}from"./index-BBJX7inb.js";import{n as _}from"./chunk-WWGJGFF6-BoMxq1lg.js";import{u as S}from"./useApi-Dn3zf_yp.js";import{B as v}from"./Badge-Bgbs80Ll.js";import{B as m}from"./Button-B1BdtBaM.js";import{C as $,b as B,a as E}from"./Card-CFtCxk2z.js";import{u as O}from"./ToastProvider-C_5kRdyY.js";import{u as P,T as R}from"./orgContext-C7qTc9MO.js";import{B as T}from"./bot-pGJOJMnB.js";import{c as N}from"./createLucideIcon-BrAVhkf1.js";import"./session-BZ9GPMw7.js";/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],H=N("crown",A);/**
 * @license lucide-react v0.561.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M11 20H2",key:"nlcfvz"}],["path",{d:"M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z",key:"au4z13"}],["path",{d:"M11 4H8a2 2 0 0 0-2 2v14",key:"74r1mk"}],["path",{d:"M14 12h.01",key:"1jfl7z"}],["path",{d:"M22 20h-3",key:"vhrsz"}]],I=N("door-open",D);function Z(){const w=_(),c=O(),{request:i,signedIn:l}=S(),{orgId:d,role:f}=P(),[r,j]=n.useState(null),[o,k]=n.useState(null),[b,y]=n.useState(!1),u=f==="admin",z=n.useMemo(()=>(r==null?void 0:r.members.filter(e=>e.role==="admin"&&!e.bot).length)??0,[r]),p=f==="admin"&&z===1,h=n.useCallback(async()=>{if(l){y(!0);try{const[e,s]=await Promise.all([i({path:`/api/v1/organizations/${d}/members`}),i({path:"/api/v1/me"})]);j(e),k(s)}catch(e){if(e&&typeof e=="object"&&"status"in e&&e.status===401)return;const s=e&&typeof e=="object"&&"message"in e?String(e.message):"";c.push({kind:"error",title:"Failed to load members",detail:s}),j(null)}finally{y(!1)}}},[l,d,i,c]);async function g(e,s){if(l)try{await i({path:`/api/v1/organizations/${d}/members/${e}`,method:"PATCH",body:{role:s}}),await h()}catch(a){if(a&&typeof a=="object"&&"status"in a&&a.status===401)return;const L=a&&typeof a=="object"&&"message"in a?String(a.message):"";c.push({kind:"error",title:"Update failed",detail:L})}}async function M(e){if(l&&confirm(`Remove member ${e}?`))try{await i({path:`/api/v1/organizations/${d}/members/${e}`,method:"DELETE"}),await h()}catch(s){if(s&&typeof s=="object"&&"status"in s&&s.status===401)return;const a=s&&typeof s=="object"&&"message"in s?String(s.message):"";c.push({kind:"error",title:"Remove failed",detail:a})}}async function C(){if(l&&confirm("Leave this organization?"))try{await i({path:`/api/v1/organizations/${d}/leave`,method:"POST"}),w("/")}catch(e){if(e&&typeof e=="object"&&"status"in e&&e.status===401)return;const s=e&&typeof e=="object"&&"message"in e?String(e.message):"";c.push({kind:"error",title:"Leave failed",detail:s})}}const x=n.useMemo(()=>[...(r==null?void 0:r.members)??[]].sort((s,a)=>Number(s.bot)-Number(a.bot)),[r]);return n.useEffect(()=>{h()},[h]),t.jsxs($,{children:[t.jsx(B,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-semibold text-content-primary",children:"Members"}),t.jsx("div",{className:"mt-1 text-sm text-content-tertiary",children:"Manage who has access to this organization."})]}),t.jsx("div",{className:"text-xs text-content-muted",children:b?"Loadingâ€¦":`${x.length} total`})]})}),t.jsx(E,{children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-left text-sm",children:[t.jsx("thead",{className:"text-xs text-content-muted",children:t.jsxs("tr",{className:"border-b border-border",children:[t.jsx("th",{className:"py-2 pr-3",children:"Name"}),t.jsx("th",{className:"py-2 pr-3",children:"Email"}),t.jsx("th",{className:"py-2 pr-3",children:"Role"}),t.jsx("th",{className:"py-2 pr-3"})]})}),t.jsxs("tbody",{children:[x.map(e=>t.jsxs("tr",{className:"border-b border-border-subtle",children:[t.jsx("td",{className:"py-3 pr-3",children:t.jsxs("div",{className:"flex items-center gap-2 font-medium text-content-primary",children:[e.bot?t.jsx(T,{className:"h-4 w-4 text-accent-text"}):null,e.name??e.email]})}),t.jsx("td",{className:"py-3 pr-3 text-content-secondary",children:e.email}),t.jsx("td",{className:"py-3 pr-3",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(v,{tone:e.role==="admin"?"neon":"muted",children:e.role}),e.bot?t.jsx(v,{tone:"muted",children:"bot"}):null]})}),t.jsx("td",{className:"py-3 pr-3",children:t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsxs(m,{variant:"secondary",size:"sm",disabled:!u||e.role==="admin",onClick:()=>g(e.account_id,"admin"),children:[t.jsx(H,{className:"h-4 w-4"}),"Promote"]}),e.account_id===(o==null?void 0:o.id)&&p?t.jsx("div",{className:"relative",title:"You're the only admin. Promote another member before demoting yourself.",children:t.jsx(m,{variant:"secondary",size:"sm",disabled:!0,children:"Demote"})}):t.jsx(m,{variant:"secondary",size:"sm",disabled:!u||e.role==="member",onClick:()=>g(e.account_id,"member"),children:"Demote"}),e.account_id===(o==null?void 0:o.id)?t.jsx("div",{className:"relative",title:p?"You're the only admin. Promote another member before leaving.":void 0,children:t.jsxs(m,{variant:"danger",size:"sm",disabled:p,onClick:C,children:[t.jsx(I,{className:"h-4 w-4"}),"Leave"]})}):t.jsxs(m,{variant:"danger",size:"sm",disabled:!u,onClick:()=>M(e.account_id),children:[t.jsx(R,{className:"h-4 w-4"}),"Remove"]})]})})]},e.account_id)),x.length===0&&!b?t.jsx("tr",{children:t.jsx("td",{colSpan:4,className:"py-6 text-center text-sm text-content-muted",children:"No members found."})}):null]})]})})})]})}export{Z as default};
