import{a,j as t}from"./index-BBJX7inb.js";import{n as y,y as b}from"./chunk-WWGJGFF6-BoMxq1lg.js";import{u as N}from"./useApi-Dn3zf_yp.js";import{B as l}from"./Badge-Bgbs80Ll.js";import{B as v}from"./Button-B1BdtBaM.js";import{C as k,a as w}from"./Card-CFtCxk2z.js";import{P as C}from"./PageLayout-DTESgE-z.js";import{u as P}from"./ToastProvider-C_5kRdyY.js";import"./session-BZ9GPMw7.js";import"./createLucideIcon-BrAVhkf1.js";function O(){const i=y(),o=P(),{token:d}=b(),{request:r,signedIn:g}=N(),[s,m]=a.useState(null),[u,p]=a.useState(!1),[h,f]=a.useState(!1),n=a.useMemo(()=>d??"",[d]),x=a.useCallback(async()=>{if(n){p(!0);try{const e=await r({path:`/api/v1/invitations/${encodeURIComponent(n)}`});m(e)}catch(e){if(e&&typeof e=="object"&&"status"in e&&e.status===401)return;const c=e&&typeof e=="object"&&"message"in e?String(e.message):"";o.push({kind:"error",title:"Invite not found",detail:c}),m(null)}finally{p(!1)}}},[n,r,o]);async function j(){if(!g){i("/auth",{state:{from:`/invite/${n}`}});return}f(!0);try{const e=await r({path:`/api/v1/invitations/${encodeURIComponent(n)}/accept`,method:"POST"});i(`/org/${e.organization_id}`)}catch(e){if(e&&typeof e=="object"&&"status"in e&&e.status===401)return;const c=e&&typeof e=="object"&&"message"in e?String(e.message):"";o.push({kind:"error",title:"Accept failed",detail:c})}finally{f(!1)}}return a.useEffect(()=>{x()},[x]),t.jsx(C,{title:"Invitation",subtitle:"Preview what you're joining before you accept.",children:t.jsx(k,{children:t.jsxs(w,{children:[u?t.jsx("div",{className:"text-sm text-content-tertiary",children:"Loadingâ€¦"}):null,s?t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"rounded-2xl border border-border bg-surface-subtle p-4",children:[t.jsx("div",{className:"text-xs text-content-muted",children:"Organization"}),t.jsx("div",{className:"mt-1 text-sm font-semibold text-content-primary",children:s.organization_name}),t.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[t.jsx(l,{tone:"muted",children:"Role"}),t.jsx(l,{tone:s.role==="admin"?"neon":"muted",children:s.role}),s.valid?null:t.jsx(l,{tone:"warn",children:"invalid"})]})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(v,{onClick:j,disabled:!s.valid||h,children:"Accept invite"}),t.jsx(v,{variant:"secondary",onClick:()=>i("/"),children:"Back"})]})]}):u?null:t.jsx("div",{className:"text-sm text-content-tertiary",children:"No preview available."})]})})})}export{O as default};
