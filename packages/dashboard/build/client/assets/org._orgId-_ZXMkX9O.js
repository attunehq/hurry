import{a as i,j as e}from"./index-BBJX7inb.js";import{n as w,y as C,O,o as z}from"./chunk-WWGJGFF6-BoMxq1lg.js";import{u as S}from"./useApi-Dn3zf_yp.js";import{B as I}from"./Badge-Bgbs80Ll.js";import{B as m}from"./Button-B1BdtBaM.js";import{C as P,a as R}from"./Card-CFtCxk2z.js";import{L as B,I as L}from"./Label-JIDdilb1.js";import{M as A}from"./Modal-CHOY4886.js";import{P as b}from"./PageLayout-DTESgE-z.js";import{u as E}from"./ToastProvider-C_5kRdyY.js";import{P as M}from"./pencil-D3z8ZhFm.js";import"./session-BZ9GPMw7.js";import"./createLucideIcon-BrAVhkf1.js";function X(){const o=w(),n=E(),{orgId:x}=C(),{request:u,signedIn:l}=S(),[t,y]=i.useState(null),[v,c]=i.useState(!1),[h,j]=i.useState(""),r=i.useMemo(()=>Number(x??"0"),[x]),f=i.useCallback(async()=>{if(!(!l||!r))try{const s=(await u({path:"/api/v1/me/organizations"})).organizations.find(p=>p.id===r)??null;y(s),s||n.push({kind:"error",title:"Org not found (or no access)"})}catch(a){if(a&&typeof a=="object"&&"status"in a&&a.status===401)return;const s=a&&typeof a=="object"&&"message"in a?String(a.message):"";n.push({kind:"error",title:"Failed to load org",detail:s})}},[l,r,u,n]),N=(t==null?void 0:t.role)==="admin";function k(){j((t==null?void 0:t.name)??""),c(!0)}async function g(){if(!l||!r)return;const a=h.trim();if(!a){n.push({kind:"error",title:"Name cannot be empty"});return}try{await u({path:`/api/v1/organizations/${r}`,method:"PATCH",body:{name:a}}),n.push({kind:"success",title:"Organization renamed"}),c(!1),await f()}catch(s){if(s&&typeof s=="object"&&"status"in s&&s.status===401)return;const p=s&&typeof s=="object"&&"message"in s?String(s.message):"";n.push({kind:"error",title:"Rename failed",detail:p})}}return i.useEffect(()=>{f()},[f]),l?e.jsxs(b,{title:e.jsxs("span",{className:"flex items-center gap-3",children:[t?t.name:"Organization",t?e.jsx(I,{tone:t.role==="admin"?"neon":"muted",children:t.role}):null]}),actions:e.jsxs(m,{variant:"secondary",onClick:k,disabled:!N,children:[e.jsx(M,{className:"h-4 w-4"}),"Rename"]}),children:[e.jsx("div",{className:"rounded-2xl border border-border bg-surface-raised p-2 shadow-glow-soft backdrop-blur",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(d,{to:"members",label:"Members"}),e.jsx(d,{to:"api-keys",label:"API Keys"}),e.jsx(d,{to:"invitations",label:"Invitations"}),e.jsx(d,{to:"bots",label:"Bots"})]})}),e.jsx(O,{context:{orgId:r,role:(t==null?void 0:t.role)??null}}),e.jsx(A,{open:v,title:"Rename organization",onClose:()=>c(!1),onSubmit:g,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"org-name",children:"Organization name"}),e.jsx(L,{id:"org-name",value:h,onChange:a=>j(a.target.value),placeholder:"Enter new name"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"secondary",onClick:()=>c(!1),children:"Cancel"}),e.jsx(m,{onClick:g,children:"Rename"})]})]})})]}):e.jsx(b,{title:"Organization",children:e.jsx(P,{children:e.jsx(R,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-content-tertiary",children:"Sign in to view this organization."}),e.jsx(m,{onClick:()=>o("/auth"),variant:"secondary",children:"Sign in"})]})})})})}function d(o){return e.jsx(z,{to:o.to,className:({isActive:n})=>["rounded-xl px-3 py-2 text-sm transition",n?"bg-surface-subtle text-content-primary":"text-content-tertiary hover:bg-surface-subtle hover:text-content-primary"].join(" "),children:o.label})}export{X as default};
