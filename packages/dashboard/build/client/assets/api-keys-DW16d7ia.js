import{a,j as e}from"./index-BBJX7inb.js";import{u as P}from"./useApi-Dn3zf_yp.js";import{B as r}from"./Button-B1BdtBaM.js";import{C as S,b as I,a as A}from"./Card-CFtCxk2z.js";import{L as T,I as K}from"./Label-JIDdilb1.js";import{M as b}from"./Modal-CHOY4886.js";import{u as B}from"./ToastProvider-C_5kRdyY.js";import{u as E,T as O}from"./orgContext-C7qTc9MO.js";import{P as L}from"./plus-BqUPOgIb.js";import{K as R}from"./key-round-BuME03QK.js";import{B as $}from"./bot-pGJOJMnB.js";import{C as z}from"./copy-DvjwGVz6.js";import"./chunk-WWGJGFF6-BoMxq1lg.js";import"./session-BZ9GPMw7.js";import"./createLucideIcon-BrAVhkf1.js";function ee(){const n=B(),{request:o,signedIn:i}=P(),{orgId:c}=E(),[l,h]=a.useState(null),[g,y]=a.useState(!1),[k,x]=a.useState(!1),[j,f]=a.useState(""),[d,p]=a.useState(null),N=a.useMemo(()=>(l==null?void 0:l.api_keys)??[],[l]),m=a.useCallback(async()=>{if(i){y(!0);try{const t=await o({path:`/api/v1/organizations/${c}/api-keys`});h(t)}catch(t){if(t&&typeof t=="object"&&"status"in t&&t.status===401)return;const s=t&&typeof t=="object"&&"message"in t?String(t.message):"";n.push({kind:"error",title:"Failed to load API keys",detail:s}),h(null)}finally{y(!1)}}},[i,c,o,n]);async function v(){if(!i)return;const t=j.trim();if(!t){n.push({kind:"error",title:"Name required"});return}try{const s=await o({path:`/api/v1/organizations/${c}/api-keys`,method:"POST",body:{name:t}});p(s),f(""),await m()}catch(s){if(s&&typeof s=="object"&&"status"in s&&s.status===401)return;const u=s&&typeof s=="object"&&"message"in s?String(s.message):"";n.push({kind:"error",title:"Create failed",detail:u})}}async function C(t){if(i&&confirm(`Revoke API key ${t}?`))try{await o({path:`/api/v1/organizations/${c}/api-keys/${t}`,method:"DELETE"}),await m()}catch(s){if(s&&typeof s=="object"&&"status"in s&&s.status===401)return;const u=s&&typeof s=="object"&&"message"in s?String(s.message):"";n.push({kind:"error",title:"Revoke failed",detail:u})}}async function w(t){try{await navigator.clipboard.writeText(t),n.push({kind:"success",title:"Copied"})}catch{n.push({kind:"error",title:"Copy failed"})}}return a.useEffect(()=>{m()},[m]),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(S,{children:[e.jsx(I,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-content-primary",children:"API Keys"}),e.jsx("div",{className:"mt-1 text-sm text-content-tertiary",children:"Keys authenticate builds and automation against Hurry."})]}),e.jsxs(r,{onClick:()=>x(!0),disabled:!i,children:[e.jsx(L,{className:"h-4 w-4"}),"New key"]})]})}),e.jsxs(A,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"text-xs text-content-muted",children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"py-2 pr-3",children:"Key"}),e.jsx("th",{className:"py-2 pr-3",children:"Owner"}),e.jsx("th",{className:"py-2 pr-3",children:"Last used"}),e.jsx("th",{className:"py-2 pr-3"})]})}),e.jsxs("tbody",{children:[N.map(t=>e.jsxs("tr",{className:"border-b border-border-subtle",children:[e.jsx("td",{className:"py-3 pr-3",children:e.jsxs("div",{className:"flex items-center gap-2 font-medium text-content-primary",children:[e.jsx(R,{className:"h-4 w-4 text-accent-text"}),t.name]})}),e.jsx("td",{className:"py-3 pr-3 text-content-secondary",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.bot?e.jsx($,{className:"h-4 w-4 text-content-muted"}):null,t.account_email]})}),e.jsx("td",{className:"py-3 pr-3 text-xs text-content-tertiary",children:t.accessed_at}),e.jsx("td",{className:"py-3 pr-3",children:e.jsx("div",{className:"flex justify-end",children:e.jsxs(r,{variant:"danger",size:"sm",onClick:()=>C(t.id),children:[e.jsx(O,{className:"h-4 w-4"}),"Revoke"]})})})]},t.id)),N.length===0&&!g?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-6 text-center text-sm text-content-muted",children:"No API keys yet."})}):null]})]})}),e.jsx("div",{className:"mt-3 text-xs text-content-muted",children:"Note: API key tokens are only shown at creation time."})]})]}),e.jsx(b,{open:k,title:"Create API key",onClose:()=>x(!1),onSubmit:v,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"keyName",children:"Name"}),e.jsx(K,{id:"keyName",value:j,onChange:t=>f(t.target.value),placeholder:"ci-key"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"secondary",onClick:()=>x(!1),children:"Cancel"}),e.jsx(r,{onClick:v,children:"Create"})]})]})}),e.jsx(b,{open:!!d,title:"API key token (save now)",onClose:()=>p(null),children:d?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-content-tertiary",children:"This token is only shown once. Copy it somewhere safe."}),e.jsxs("div",{className:"rounded-2xl border border-border bg-surface-subtle p-4",children:[e.jsx("div",{className:"text-xs text-content-muted",children:"Token"}),e.jsx("div",{className:"mt-1 break-all font-mono text-xs text-content-primary",children:d.token})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(r,{variant:"secondary",onClick:()=>w(d.token),children:[e.jsx(z,{className:"h-4 w-4"}),"Copy"]}),e.jsx(r,{onClick:()=>p(null),children:"Done"})]})]}):null})]})}export{ee as default};
