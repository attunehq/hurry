import{a as s,j as e}from"./index-BBJX7inb.js";import{n as h,x as f}from"./chunk-WWGJGFF6-BoMxq1lg.js";import{B as g,e as p}from"./Button-B1BdtBaM.js";import{u as j}from"./session-BZ9GPMw7.js";import{C as k,a as y}from"./Card-CFtCxk2z.js";import{P as v}from"./PageLayout-DTESgE-z.js";function P(){const a=h(),{setSessionToken:o}=j(),[i]=f(),[c,n]=s.useState("working"),[u,l]=s.useState(null),d=s.useRef(!1),r=s.useMemo(()=>i.get("auth_code"),[i]);return s.useEffect(()=>{if(d.current)return;d.current=!0;async function m(){if(!r){n("error"),l("Missing auth_code in callback URL.");return}try{const t=await p(r);o(t.session_token),n("done"),a("/")}catch(t){const x=t&&typeof t=="object"&&"message"in t?String(t.message):"";n("error"),l(x||"Failed to exchange auth code.")}}m()},[r,a,o]),e.jsx(v,{title:"Signing you in…",subtitle:"Exchanging OAuth callback code for a session token.",children:e.jsx(k,{children:e.jsxs(y,{children:[c==="working"?e.jsx("div",{className:"text-sm text-content-tertiary",children:"Working…"}):null,c==="error"?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-red-600 dark:text-red-200",children:"Sign-in failed."}),u?e.jsx("div",{className:"text-xs text-content-tertiary",children:u}):null,e.jsx("div",{className:"flex gap-2",children:e.jsx(g,{variant:"secondary",onClick:()=>a("/auth"),children:"Back to auth"})})]}):null]})})})}export{P as default};
