#!/usr/bin/env bash
set -euo pipefail

if [ -z "${COURIER_DATABASE_URL:-}" ]; then
  echo "Error: COURIER_DATABASE_URL environment variable is not set" >&2
  exit 1
fi

if ! RESULT=$(psql "$COURIER_DATABASE_URL" -c "SELECT id, name, created_at FROM organization ORDER BY id;" 2>&1); then
  echo "Error: Failed to list organizations" >&2
  echo "$RESULT" >&2
  exit 1
fi

echo "$RESULT"
